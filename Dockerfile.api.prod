FROM node:18
LABEL AUTHOR="Gbenga Anifowoshe <daveanifowoshe@gmail.com>"

RUN apt update

# Yarn
RUN export DEBIAN_FRONTEND=noninteractive
RUN apt-get -yq install curl
RUN curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -
RUN echo "deb https://dl.yarnpkg.com/debian/ stable main" > /etc/apt/sources.list.d/yarn.list
RUN apt install -y yarn

COPY ./yarn.lock /app/
COPY ./tsconfig-base.json /app/
COPY ./package.json /app/
COPY ./.prettierrc.js /app/
COPY ./packages/api/package.json /app/packages/api/

WORKDIR /app

RUN yarn install
COPY ./packages/api /app/packages/api/

WORKDIR /app/packages/api

RUN yarn build
CMD yarn prod